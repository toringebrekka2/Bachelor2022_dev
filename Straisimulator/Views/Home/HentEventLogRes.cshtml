@model Straisimulator.ViewModels.HentEventLogResViewModel
@{
    ViewData["Title"] = "Hent kø-tid";
}

<!--- <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.3.1/dist/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"> --->



<script src="~/js/FileSaver.js"></script>
<script>
    function fnExcelReport(id, name) {
        var tab_text = '<html xmlns: x="urn:schemas-microsoft-com:office:excel">';
        tab_text = tab_text + '<head><xml><x: ExcelWorkbook><x: ExcelWorksheets><x: ExcelWorksheet>';
        tab_text = tab_text + '<x: Name>Test Sheet</x: Name>';
        tab_text = tab_text + '<x: WorksheetOptions><x: Panes></x: Panes></x: WorksheetOptions ></x: ExcelWorksheet > ';
        tab_text = tab_text + '</x:ExcelWorksheets></x:ExcelWorkbook></xml></head><body>';
        tab_text = tab_text + "<table border='1px' style='color:black'>";


        var exportTable = $('#' + id).clone();
        exportTable.find('th').last().remove();
        exportTable.find('input').each(function (index, elem) { $(elem).remove(); });
        exportTable.find('a').each(function (index, elem) { $(elem).remove(); });

        tab_text = tab_text + exportTable.html();
        tab_text = tab_text + '</table></body></html>';
        var fileName = "Køtid_i_ordre" + '.xls';

        //Save the file
        var blob = new Blob([tab_text], { type: "application/vnd.ms-excel;charset=utf-8" })
        window.saveAs(blob, fileName);
    }
</script>


<div class="container-eventlogRes">
    <h4>Køtid i ordre *ordrenr*</h4>
    
    <div class="flex">
        <form class="searchbar-2" asp-controller="Home" asp-action="HentEventLogRes" method="post">
            <input type="text" name="OrderId" placeholder="Søk på nytt ordrenr"required/><br/>
            <button type="submit"><img src="../wwwroot/images/search.png"> </button>
        </form>
        
        <button type="button" class="excel" onclick="fnExcelReport('dataTable', 'data')">Last ned som Excel fil</button>
    </div>

    <table class="quetime-table">
        <thead></thead>
        <tr>
            <td>Samlet køtid for ordre:</td>
            <td id="td-que">@Model.ProductionEventList.TotalOrderQue</td>
        </tr>
    </table>
    
    <table class="content-table" id="dataTable">
        <thead>
        <tr>
            <th>Event ID</th>
            <th>Production ID (skap)</th>
            <th>Hendelsestype</th>
            <th>Maskin</th>
            <th>Operasjonstid</th>
            <th>Cykeltid</th>
            <th>Køtid/Dødtid</th>
            <th>Beskrivelse</th>
        </tr>
        </thead>
        @foreach (Event productionEvent in Model.ProductionEventList.ProductionEvents)
        {
            <tr>
                <td>@productionEvent.Id</td>
                <td>@productionEvent.ProductionId</td>
                <td>@productionEvent.EventType</td>
                <td>@productionEvent.Maskin</td>
                <td>
                    @if (productionEvent.OpAndCykAsTimeSpan.Count != 0)
                    {
                        @productionEvent.OpAndCykAsTimeSpan[0]
                    }
                </td>
                <td>
                    @if (productionEvent.OpAndCykAsTimeSpan.Count != 0)
                    {
                        @productionEvent.OpAndCykAsTimeSpan[1]
                    }
                </td>
                <td>@productionEvent.Que</td>
                <td>production comment</td>
            </tr>
        }
    </table>
</div>